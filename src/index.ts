import { ElevenLabsClient } from "@elevenlabs/elevenlabs-js";
import dotenv from "dotenv";
import OpenAI from "openai";
import { textToSpeech } from "./tts.js";
import { createTextToRead } from "./prompt.js";

dotenv.config();

if (!process.env.OPENAI_API_KEY) {
  throw Error("API key is required.");
}
if (!process.env.ELEVENLABS_API_KEY) {
  throw Error("API key is required.");
}

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
const elevenlabs = new ElevenLabsClient({
  apiKey: process.env.ELEVENLABS_API_KEY,
});

// console.log(await elevenlabs.models.list());
// console.log(await elevenlabs.voices.getAll());
// throw Error();

// const text = await createTextToRead(
//   openai,
//   `
// ### 結城はるみさんのレポートスタイルを再現するためのプロンプト

// 提供された情報源から抽出した結城はるみさんのコミュニケーションスタイルの特徴に基づき、レポートの生成時には以下の要素を組み合わせてください。

// **I. レポートの構成と導入**

// *   **主題と概要の明確化:** レポートの冒頭で主題と概要を明確に提示し、読者の全体理解を促します。
// *   **関心の高い話題からの導入:** 最新のニュースや市場の主要な動きから導入し、丁寧かつ客観的な言葉遣いで解説を始めます。例：円安の歴史的水準、日銀の金融政策、主要企業の決算発表、地政学リスク、AI技術の進展など。
// *   **関連情報への言及:** 報告書の内容を補完する関連情報や詳細な分析への参照を適切に行い、読者がさらに深く理解できるよう促します。

// **II. 説明と分析のスタイル**

// *   **対象の明確な提示:** 「〇〇という の は～」や「〇〇って いう の は～」のように、分析対象や概念を明確にしてから説明に入り、読者の誤解を防ぎます。
// *   **読者の疑問への配慮:** 読者が抱きうる疑問や懸念を先回りして提示し、それに対して具体的かつ明確な解説を行います。
// *   **専門用語の平易な解説:** 株式投資や経済に関する専門用語を使用する際は、初心者にも理解できるよう、例え話や日常的な話題を交え、分かりやすく説明します。
// *   **重要なポイントの強調:** 重要な論点や結論は繰り返したり、「～という点が非常に重要です」のように明確に強調したりします。
// *   **論旨の整理と構造化:** 報告書の冒頭で概要を示したり、途中で「ここで一度整理してみますと」と話をまとめたりするなど、読者が内容を理解しやすいように話の構造を意識して記述します。
// *   **専門知識と経験の共有:** 報告書の内容に関連する自身の専門知識、経験、または観察結果を簡潔に共有し、分析の信頼性や具体性を高めます。ただし、過度に個人的な記述は避けます。

// **III. 情報の裏付けと論拠**

// *   **具体的な情報源の明示:** ニュース記事、企業のIR情報、経済指標などを具体的に示しながら解説し、「ロイターさんのほうで～という報道がありました」、「～社のホームページによりますと」のように情報源を明確に提示します。
// *   **データとチャートの活用:** チャートやデータに基づいた分析を行い、市場の動向や個別銘柄の状況を視覚的・定量的に説明します。

// **IV. 市場の見通しと投資戦略**

// *   **多角的な分析:** 短期的な市場の動きだけでなく、中長期的な視点も踏まえた分析を行い、今後の見通しや取るべき投資戦略について言及します。
// *   **率直な意見表明:** 自身の分析に基づく投資判断や注意点を率直に語り、「個人的には～のように考えています」、「～には注意が必要です」といった意見を述べます。
// *   **注目銘柄・セクターの理由付け:** 特定の銘柄やセクターに注目する理由や、その背景にある経済・市場のトレンドを丁寧に説明します。
// *   **リスクへの注意喚起:** 潜在的なリスクについても明確に言及し、「～というリスクも考慮しておく必要があります」、「～には注意が必要です」のように注意喚起を行います。

// **V. レポートの締め**

// *   **簡潔な結論と提言:** レポートの内容を簡潔にまとめ、主要な結論や提言を明確に提示します。
// *   **客観的かつ落ち着いたトーン:** レポート全体を通して客観的かつ落ち着いたトーンを保ちつつ、特に重要な箇所や強調したい点においては、明確で力強い表現を用いることで、専門家としての信頼性を確保します。
// `,
//   "今日の株式市場のニュースを調べて、アナウンサーが読む台本にして。"
// );
// console.log(text);
await textToSpeech(
  elevenlabs,
  `本日の主な動きです。アジア株は軟調。背景には、米国の新たな関税措置が意識されています。欧州は小反発、米国ではこの後、物価指標PCEの発表が控え、様子見ムードです。原油は週末にかけて上昇基調、為替はドル高が続いています。

きょうの東京市場、日経平均は0.9％安、およそ4万5千円台半ばまで下落。大統領の新関税—「医薬品に最大100％、大型トラックに25％、家具関連にも高関税」—が嫌気され、製薬株を中心に売られました。韓国コスピは2.5％安。香港、中国本土も下落基調です。

補足です。東京都区部の物価9月・先行指標はコアで前年比2.5％と前月並み。日銀の目標は上回るものの、市場予想2.8％は下回りました。利上げ時期の見方はやや慎重になっています。

欧州は反発。ストックス600は0.3％高。金融や資本財が買い戻される一方、関税の余波でヘルスケアは軟調です。EUが中国製鋼材に25～50％の関税を検討との報も伝わっています。

日本時間今夜、米国のPCEデフレーターが発表予定です。PCEというのは「個人消費の物価」を示す指標で、FRBが重視します。市場は前月比＋0.3％、前年比＋2.7％程度を見込む声が多く、結果次第で利下げ観測の度合いが変わり得ます。

原油は今週4％超の上昇へ。ロシアの燃料輸出制限やウクライナ情勢が材料です。金は横ばい圏。為替はドル高基調で、ドル円は150円に接近しています。

ここで一度整理してみます。関税というのは、輸入品にかける税金のこと。コスト増が企業収益や物価に波及しやすい点が非常に重要です。今回は医薬品やトラック、家具などに高率が示され、アジアの関連株に売りが広がりました。一方で、米PCEの結果如何で金利観測が揺れやすく、為替・株・商品に同時に影響が及ぶ可能性があります。

きょうは米PCEと関税の波及を見極める一日です。短期的には価格変動が大きくなりやすいため、材料の真偽と公式発表の時刻を確認しながら、過度なリスクは避ける姿勢が必要です。以上、マーケットヘッドラインでした。`
);
